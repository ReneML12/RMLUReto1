name: Listar ramas de todos los repos

on:
  workflow_dispatch:

jobs:
  listar-ramas:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout vac√≠o
        uses: actions/checkout@v4

      - name: Listar repos y ramas
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üîç Obteniendo lista de repositorios..."

          # Obtener todos los repositorios
          repos=$(gh repo list ReneML12 --limit 200 --json name --jq '.[].name')

          echo "üìå Repos encontrados:"
          echo "$repos"
          echo "-----------------------------------------"

          # Recorrer todos los repositorios
          for repo in $repos; do
            echo "üìÅ REPO: $repo"
            echo "-----------------------------------------"

            # Obtener ramas del repo
            branches=$(gh api repos/ReneML12/$repo/branches --jq '.[].name')

            # Validar si tiene ramas
            if [ -z "$branches" ]; then
              echo "‚ö†Ô∏è No se encontraron ramas en $repo"
            else
              echo "üåø Ramas encontradas en $repo:"
              for branch in $branches; do
                # Obtener informaci√≥n detallada de cada rama
                last_commit=$(gh api repos/ReneML12/$repo/branches/$branch --jq '.commit.sha')
                last_date=$(gh api repos/ReneML12/$repo/commits/$last_commit --jq '.commit.author.date')

                echo " - Rama: $branch"
                echo "   √öltimo commit: $last_commit"
                echo "   Fecha del √∫ltimo commit: $last_date"
              done
            fi

            echo "========================================="
          done

